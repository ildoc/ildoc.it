
<!DOCTYPE html>
<html lang="italian">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="/theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/font-awesome.min.css">


    <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="ildoc's Atom">



  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="index, follow" />


<meta name="author" content="Doc" />
<meta name="description" content="Come seguito al post precedente, ecco una funzioncina per buildare una solution da codice. Questa funzione NON tiene conto di eventuali build configuration e/o di progetti unloadati. A mio avviso è un bug dell&#39;msbuild (e non l&#39;unico, direi), in quanto, provando a buildare la stessa solution da codice, da …" />
<meta name="keywords" content="c#, visual studio, msdn">

<meta property="og:site_name" content="ildoc's"/>
<meta property="og:title" content="Build di una solution da codice"/>
<meta property="og:description" content="Come seguito al post precedente, ecco una funzioncina per buildare una solution da codice. Questa funzione NON tiene conto di eventuali build configuration e/o di progetti unloadati. A mio avviso è un bug dell&#39;msbuild (e non l&#39;unico, direi), in quanto, provando a buildare la stessa solution da codice, da …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="/build-di-una-solution-da-codice.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2014-03-20 16:05:00+01:00"/>
<meta property="article:modified_time" content="2015-03-26 13:50:42+01:00"/>
<meta property="article:author" content="/author/doc.html">
<meta property="article:section" content="misc"/>
<meta property="article:tag" content="c#"/>
<meta property="article:tag" content="visual studio"/>
<meta property="article:tag" content="msdn"/>
<meta property="og:image" content="">

  <title>ildoc's &ndash; Build di una solution da codice</title>

</head>
<body>
  <aside>
    <div>
      <a href="">
        <img src="/theme/img/profile.png" alt="ildoc's" title="ildoc's">
      </a>
      <h1><a href="">ildoc's</a></h1>


      <nav>
        <ul class="list">

          <li><a href="http://getpelican.com/" target="_blank">Pelican</a></li>
          <li><a href="http://python.org/" target="_blank">Python.org</a></li>
          <li><a href="http://jinja.pocoo.org/" target="_blank">Jinja2</a></li>
          <li><a href="#" target="_blank">You can modify those links in your config file</a></li>
        </ul>
      </nav>

      <ul class="social">
        <li><a class="sc-Twitter" href="https://twitter.com/il_doc" target="_blank"><i class="fa fa-Twitter"></i></a></li>
        <li><a class="sc-GitHub" href="https://github.com/ildoc" target="_blank"><i class="fa fa-GitHub"></i></a></li>
      </ul>
    </div>


  </aside>
  <main>


<article class="single">
  <header>
      
    <h1 id="build-di-una-solution-da-codice">Build di una solution da codice</h1>
    <p>
          Posted on gio 20 marzo 2014 in <a href="/category/misc.html">misc</a>


    </p>
  </header>


  <div>
    <p>Come seguito al <a href="/get-latest-da-codice-di-un-progetto-su-tfs/">post
precedente</a>,
ecco una funzioncina per buildare una solution da codice.</p>
<p>Questa funzione NON tiene conto di eventuali build configuration e/o di
progetti unloadati.<br>
A mio avviso è un bug dell'msbuild (e non l'unico, direi), in quanto,
provando a buildare la stessa solution da codice, da visual studio e da
console si ottengono SEMPRE risultati diversi.</p>
<p>Ho chiesto all'inutile-come-sempre supporto msdn, ma mi solo solo fatto
del gran nervoso, ecco il
<a href="http://social.msdn.microsoft.com/Forums/vstudio/en-US/0f2bb4fc-c9dd-4dfc-8791-338ceac04c1c/remove-projects-from-a-solution-programmatically">link</a>
alla discussione.</p>
<div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">static</span> <span class="kt">bool</span> <span class="nf">BuildSolution</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">bool</span> <span class="n">result</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="kt">string</span> <span class="n">solutionPath</span> <span class="p">=</span> <span class="s">@&quot;C:\path\della\solution.sln&quot;</span><span class="p">;</span>

        <span class="n">ProjectCollection</span> <span class="n">pc</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ProjectCollection</span><span class="p">();</span>

        <span class="c1">//definiamo le property della build (ci sono miliardi di opzioni diverse)</span>
        <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span> <span class="n">globalProperty</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;();</span>
        <span class="n">globalProperty</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s">&quot;Configuration&quot;</span><span class="p">,</span> <span class="s">&quot;Release&quot;</span><span class="p">);</span>
        <span class="n">globalProperty</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s">&quot;Platform&quot;</span><span class="p">,</span> <span class="s">&quot;Any CPU&quot;</span><span class="p">);</span>
        <span class="n">globalProperty</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s">&quot;OutputPath&quot;</span><span class="p">,</span> <span class="s">&quot;bin\Debug&quot;</span><span class="p">);</span>

        <span class="n">BuildParameters</span> <span class="n">bp</span> <span class="p">=</span> <span class="k">new</span> <span class="n">BuildParameters</span><span class="p">(</span><span class="n">pc</span><span class="p">);</span>
        <span class="n">BuildRequestData</span> <span class="n">BuidlRequest</span> <span class="p">=</span> <span class="k">new</span> <span class="n">BuildRequestData</span><span class="p">(</span><span class="n">solutionPath</span><span class="p">,</span> <span class="n">globalProperty</span><span class="p">,</span> <span class="s">&quot;4.0&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="kt">string</span><span class="p">[]</span> <span class="p">{</span> <span class="s">&quot;Build&quot;</span> <span class="p">},</span> <span class="k">null</span><span class="p">);</span>
        <span class="n">BuildResult</span> <span class="n">buildResult</span> <span class="p">=</span> <span class="n">BuildManager</span><span class="p">.</span><span class="n">DefaultBuildManager</span><span class="p">.</span><span class="n">Build</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">BuidlRequest</span><span class="p">);</span>

        <span class="c1">//questo è il modo più semplice per controllare che la build sia andata a buon fine</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">buildResult</span><span class="p">.</span><span class="n">OverallResult</span> <span class="p">==</span> <span class="n">BuildResultCode</span><span class="p">.</span><span class="n">Success</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Build eseguita correttamente&quot;</span><span class="p">);</span>
            <span class="n">result</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
            <span class="c1">//a volte succede che l&#39;exception sia null</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">buildResult</span><span class="p">.</span><span class="n">Exception</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
                <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Build fallita: lista errori non disponibile&quot;</span><span class="p">);</span>
            <span class="k">else</span>
                <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Build fallita: &quot;</span> <span class="p">+</span> <span class="n">buildResult</span><span class="p">.</span><span class="n">Exception</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Build Fallita: &quot;</span> <span class="p">+</span> <span class="n">e</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>Quando si è in cerca di soluzioni relative all'ambiente .NET, consiglio
di evitare come la peste tutto quello che nell'url ha "msdn".<br>
Rispondono alle discussioni esclusivamente per aumentare il loro post
count nella speranza di ottenere qualche punto per poi bullarsi di
essere "MSMVP", un titolo che mi sembra che venga dato assolutamente a
caso.<br>
Si segnano come risposte i loro post inutili, aumentandosi il rank da
soli.</p>
<p>"Non mi builda la soluzione"<br>
"Hai provato a buildare?"<br>
"Ma ho appena detto che..."<br>
"Ma se buildi da console?"<br>
"Ma veramente..."<br>
"La soluzione ti builda?"<br>
"..."</p>
<p>---<em>"La soluzione ti builda?" è stata segnata come risposta al thread</em></p>
<p>E ricordate, se avrete a che fare con il supporto msdn sappiate che
sarete nel torto a prescindere.<br>
Visual Studio non ha bachi, il problema sarà sicuramente sempre colpa
vostra.</p>
<p><img alt="mabaffanculo" src="/static/images/posts/mabaffanculo.jpg"></p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="/tag/c.html">c#</a>
      <a href="/tag/visual-studio.html">visual studio</a>
      <a href="/tag/msdn.html">msdn</a>
    </p>
  </div>



    <div class="addthis_relatedposts_inline">


</article>

    <footer>
<p>
  &copy;   - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
         src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>





<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " ildoc's ",
  "url" : "",
  "image": "",
  "description": ""
}
</script>

</body>
</html>